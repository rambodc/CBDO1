this.CABLES=this.CABLES||{},this.CABLES.COREMODULES=this.CABLES.COREMODULES||{},this.CABLES.COREMODULES.Ammoworld=function(i){var e={};function t(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return i[s].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=i,t.c=e,t.d=function(i,e,s){t.o(i,e)||Object.defineProperty(i,e,{enumerable:!0,get:s})},t.r=function(i){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},t.t=function(i,e){if(1&e&&(i=t(i)),8&e)return i;if(4&e&&"object"==typeof i&&i&&i.__esModule)return i;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:i}),2&e&&"string"!=typeof i)for(var o in i)t.d(s,o,function(e){return i[e]}.bind(null,o));return s},t.n=function(i){var e=i&&i.__esModule?function(){return i.default}:function(){return i};return t.d(e,"a",e),e},t.o=function(i,e){return Object.prototype.hasOwnProperty.call(i,e)},t.p="",t(t.s=0)}([function(i,e){const t=class extends CABLES.EventTarget{constructor(){super(),this.world=null,this.bodies=[],this._countIndex=1,this._bodymeta={},this.lastTime=performance.now(),this._collisionCb=[],this.numCollisionsListeners=0,this.setupWorld()}setupWorld(){this.collisionConfiguration=new Ammo.btDefaultCollisionConfiguration,this.dispatcher=new Ammo.btCollisionDispatcher(this.collisionConfiguration),this.overlappingPairCache=new Ammo.btDbvtBroadphase,this.solver=new Ammo.btSequentialImpulseConstraintSolver,this.world=new Ammo.btDiscreteDynamicsWorld(this.dispatcher,this.overlappingPairCache,this.solver,this.collisionConfiguration),this.world.setGravity(new Ammo.btVector3(0,-9,0))}getListBodies(){const i=[];for(let e in this._bodymeta)i.push(this._bodymeta[e]);return i}dispose(){if(this.world){this.emitEvent("dispose");for(let i=0;i<this.bodies.length;i++)this.bodies[i]&&(this.world.removeRigidBody(this.bodies[i]),Ammo.destroy(this.bodies[i]));this.bodies=[],Ammo.destroy(this.world),this.world=null,Ammo.destroy(this.collisionConfiguration),Ammo.destroy(this.dispatcher),Ammo.destroy(this.overlappingPairCache),Ammo.destroy(this.solver)}}removeRigidBody(i){const e=this.bodies.indexOf(i),t=i.getUserIndex();this.world&&i&&this.world.removeRigidBody(i),e>-1&&this.bodies.splice(e,1),delete this._bodymeta[t]}createRigidBody(){}addRigidBody(i){this.world&&(i.setUserIndex(++this._countIndex),this.world.addRigidBody(i),this.bodies.push(i))}setBodyMeta(i,e){0==i.getUserIndex()&&i.setUserIndex(++this._countIndex),e.body=i,this._bodymeta[i.getUserIndex()]=e}getBodyMeta(i){return this._bodymeta[i.getUserIndex()]}getBodyByName(i){for(let e in this._bodymeta)if(this._bodymeta[e].name==i)return this._bodymeta[e].body}numBodies(){return this.bodies.length}frame(){if(!this.world)return;let i=performance.now()-this.lastTime;this.world.stepSimulation(i,5),this._checkCollisions(),this.lastTime=performance.now()}activateAllBodies(){for(let i=0;i<this.bodies.length;i++)this.bodies[i].activate()}removeCollision(i){let e=-1;for(let t=0;t<this._collisionCb.length;t++)this._collisionCb[t].id==i&&(e=t);this._collisionCb.splice(e,1),this.numCollisionsListeners=this._collisionCb.length}onCollision(i,e,t){const s={name0:i,name1:e,cb:t,id:CABLES.uuid()};return this._collisionCb.push(s),this.numCollisionsListeners=this._collisionCb.length,s.id}_emitCollision(i,e,t,s){i._isColliding=!0,i.cb(e,t,s)}_checkCollisions(){let i=this.dispatcher.getNumManifolds();for(let i=0;i<this._collisionCb.length;i++)this._collisionCb[i]._wasColliding=this._collisionCb[i]._isColliding,this._collisionCb[i]._isColliding=!1;for(let e=0;e<i;e++){let i=this.dispatcher.getManifoldByIndexInternal(e),t=i.getNumContacts();for(let e=0;e<t;e++){let e=this.getBodyMeta(i.getBody0()),t=this.getBodyMeta(i.getBody1());if(e&&t)for(let s=0;s<this._collisionCb.length;s++)e.name==this._collisionCb[s].name0&&(this._collisionCb[s].name1?t.name==this._collisionCb[s].name1&&this._emitCollision(this._collisionCb[s],!0,t,i):this._emitCollision(this._collisionCb[s],!0,t,i)),t.name==this._collisionCb[s].name0&&(this._collisionCb[s].name1?e.name==this._collisionCb[s].name1&&this._emitCollision(this._collisionCb[s],!0,e,i):this._emitCollision(this._collisionCb[s],!0,e,i))}}for(let i=0;i<this._collisionCb.length;i++)!this._collisionCb[i]._isColliding&&this._collisionCb[i]._wasColliding&&(this._emitCollision(this._collisionCb[i],!1,null,null),this._collisionCb[i]._isColliding=this._collisionCb[i]._wasColliding=!1)}};t._getGeomTriangle=function(i,e){const t=[0,0,0,0,0,0,0,0,0];if(i.verticesIndices&&i.verticesIndices.length){const s=3*e,o=3*(e+1),n=3*(e+2);t[0]=i.vertices[3*i.verticesIndices[s]+0],t[1]=i.vertices[3*i.verticesIndices[s]+1],t[2]=i.vertices[3*i.verticesIndices[s]+2],t[3]=i.vertices[3*i.verticesIndices[o]+0],t[4]=i.vertices[3*i.verticesIndices[o]+1],t[5]=i.vertices[3*i.verticesIndices[o]+2],t[6]=i.vertices[3*i.verticesIndices[n]+0],t[7]=i.vertices[3*i.verticesIndices[n]+1],t[8]=i.vertices[3*i.verticesIndices[n]+2]}else t[0]=i.vertices[9*e+0],t[1]=i.vertices[9*e+1],t[2]=i.vertices[9*e+2],t[3]=i.vertices[9*e+3],t[4]=i.vertices[9*e+4],t[5]=i.vertices[9*e+5],t[6]=i.vertices[9*e+6],t[7]=i.vertices[9*e+7],t[8]=i.vertices[9*e+8];return t},t.createConvexHullFromGeom=function(i,e,t){t=t||[1,1,1];const s=new Ammo.btConvexHullShape,o=new Ammo.btVector3(0,0,0);new Ammo.btVector3(0,0,0),new Ammo.btVector3(0,0,0);let n=1;i.vertices.length/3>e&&e>0&&(n=Math.floor(i.vertices.length/3/e));for(let e=0;e<i.vertices.length/3;e+=n)o.setX(i.vertices[3*e+0]*t[0]),o.setY(i.vertices[3*e+1]*t[1]),o.setZ(i.vertices[3*e+2]*t[2]),s.addPoint(o,!0);return s.initializePolyhedralFeatures(),s},t.copyCglTransform=function(i,e){const t=new Ammo.btVector3(0,0,0),s=new Ammo.btQuaternion(0,0,0,1),o=vec3.create(),n=quat.create();mat4.getTranslation(o,i.mMatrix),mat4.getRotation(n,i.mMatrix),t.setValue(o[0],o[1],o[2]),s.setValue(n[0],n[1],n[2],n[3]),e.setOrigin(t),e.setRotation(s),Ammo.destroy(t),Ammo.destroy(s)},CABLES.AmmoWorld=t}]).Cables;